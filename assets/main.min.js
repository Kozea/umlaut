/*! umlaut           2014-05-20 */

(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},xc={}.hasOwnProperty,yc=function(a,b){function c(){this.constructor=a}for(var d in b)xc.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},zc=function(a,b){return function(){return a.apply(b,arguments)}};cc=Math.PI,lc=function(a){return 180*a/cc},mc=function(a){return cc*a/180},vb=function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))},ec=function(a,b){return{x:a.x*Math.cos(b)-a.y*Math.sin(b),y:a.x*Math.sin(b)+a.y*Math.cos(b)}},Sb=function(a){return(a%(2*cc)+2*cc)%(2*cc)},mb=function(a,b){return Sb(Math.atan2(a,b))},nc=function(a){return lc(Sb(a))},pb={N:3*cc/2,S:cc/2,W:cc,E:0},lb=function(a){return a>cc/4&&3*cc/4>=a?"S":a>3*cc/4&&5*cc/4>=a?"W":a>5*cc/4&&7*cc/4>=a?"N":"E"},qb=function(a){switch(a){case"N":return{x:0,y:-1};case"S":return{x:0,y:1};case"W":return{x:-1,y:0};case"E":return{x:1,y:0};case"SE":return{x:1,y:1};case"SW":return{x:-1,y:1};case"NW":return{x:-1,y:-1};case"NE":return{x:1,y:-1}}},kc=function(){return 1e3*(new Date).getTime()+Math.round(1e3*Math.random())},ob=function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()},Xb=function(a,b){var c,d;return c=Object.keys(a),d=c[(c.indexOf(b)+1)%c.length],0===d.indexOf("_")?Xb(a,d):d},Qb=function(a,b){var c;for(c in b)a[c]=b[c];return a},_b=function(a){var b,c;c={};for(b in a)c[b]=a[b];return c},Rb=function(a,b){var c,d;d={};for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d},Zb=function(a){var b,c,d,e,f;return a.attrs?(e=[],b=a.attrs,d=(null!=(f=b.style)?f.split(","):void 0)||[],wc.call(d,"invisible")>=0&&e.push("display: none"),wc.call(d,"dashed")>=0&&e.push("stroke-dasharray: 10, 5"),wc.call(d,"dotted")>=0&&e.push("stroke-dasharray: 2, 6"),wc.call(d,"bold")>=0&&e.push("stroke-width: 2.5"),c=wc.call(d,"filled")>=0?b.fillcolor||b.color:b.fillcolor,c&&e.push("fill: "+c+";"),null!=b.color&&e.push("stroke: "+b.color+";"),e.join("; ")||void 0):void 0},hc=function(){return 1},nb=function(a,b){var c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],f.push({key:c,self:b});return f},d3.selection.prototype.dblTap=function(a){var b;return b=0,this.each(function(){return d3.select(this).on("touchstart",function(c){var d;return d3.event.timeStamp-b<500?(d=a(c),d3.event.preventDefault(),d):b=d3.event.timeStamp})})},g=function(){function a(){this.cls=this.constructor}return a.prototype["super"]=function(a,b,c){return null==b&&(b=null),null==c&&(c=[]),(b||this.cls).__super__[a].apply(this,c)},a}(),F={},E=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.get=function(a,b,c,d){return"M "+c.x+" "+c.y+" L "+d.x+" "+d.y},b}(g),F.Diagonal=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(E),F.Rectangular=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.get=function(a,b,c,d,e,f){var g,h,i,j;return g=Math.abs(e%cc)<cc/4,h=Math.abs(f%cc)<cc/4,j="M "+c.x+" "+c.y+" L",!g&&h?j=""+j+" "+c.x+" "+d.y:g&&!h?j=""+j+" "+d.x+" "+c.y:g&&h?(i=c.x+.5*(d.x-c.x),j=""+j+" "+i+" "+c.y+" L "+i+" "+d.y):g||h||(i=c.y+.5*(d.y-c.y),j=""+j+" "+c.x+" "+i+" L "+d.x+" "+i),""+j+" L "+d.x+" "+d.y},b}(E),F.Arc=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.get=function(a,b,c,d,e,f){var g,h,i,j,k;return g=Math.abs(e%cc)<cc/4,h=Math.abs(f%cc)<cc/4,j=Math.abs(c.x-d.x),k=Math.abs(c.y-d.y),i="M "+c.x+" "+c.y+" A "+j+" "+k+" 0 0 1 "+d.x+" "+d.y},b}(E),F.Demicurve=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.get=function(a,b,c,d,e,f){var g,h,i,j;return g=Math.abs(e%cc)<cc/4,h=Math.abs(f%cc)<cc/4,j="M "+c.x+" "+c.y+" C",i={x:.5*(c.x+d.x),y:.5*(c.y+d.y)},j=g?""+j+" "+i.x+" "+c.y:""+j+" "+c.x+" "+i.y,j=h?""+j+" "+i.x+" "+d.y:""+j+" "+d.x+" "+i.y,""+j+" "+d.x+" "+d.y},b}(E),F.Curve=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.get=function(a,b,c,d,e,f){var g,h,i,j;return j="M "+c.x+" "+c.y+" C",g=vb(c,d,e,f)/2,a===b&&(g*=4,(e+f)%cc===0&&(e-=cc/4,f+=cc/4)),h=Math.cos(e)*g,i=Math.sin(e)*g,j=""+j+" "+(c.x+h)+" "+(c.y+i),h=Math.cos(f)*g,i=Math.sin(f)*g,j=""+j+" "+(d.x+h)+" "+(d.y+i),""+j+" "+d.x+" "+d.y},b}(E),F.Rationalcurve=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.get=function(a,b,c,d,e,f){var g,h,i;return i="M "+c.x+" "+c.y+" C",a===b&&(e+f)%cc===0&&(e-=cc/4,f+=cc/4),g=Math.cos(e)*a.width(),h=Math.sin(e)*a.height(),a===b&&(g*=4,h*=4),i=""+i+" "+(c.x+g)+" "+(c.y+h),g=Math.cos(f)*b.width(),h=Math.sin(f)*b.height(),a===b&&(g*=4,h*=4),i=""+i+" "+(d.x+g)+" "+(d.y+h)+" "+d.x+" "+d.y},b}(E),I={},H=function(a){function b(a,c){this.open=null!=a?a:!1,this.start=null!=c?c:!1,b.__super__.constructor.apply(this,arguments),this.id=this.cls.name,this.open&&(this.id+="Open"),this.start&&(this.id+="Start")}return yc(b,a),b.prototype.margin=function(){return 6},b.prototype.width=function(){return 20},b.prototype.height=function(){return 20},b.prototype.w=function(){return this.start?this.width():-this.width()},b.prototype.viewbox=function(){var a,b,c;return c=this.width()+this.margin(),b=this.start?0:this.margin()/2-c,a=this.height()+this.margin(),""+b+" "+-a/2+" "+c+" "+a},b}(g),I.None=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){return"M 0 0"},b}(H),I.Vee=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,b,c,d;return d=this.w(),a=this.height(),c=d/3,b=a/2,"M 0 0 L "+d+" "+-b+" L "+c+" 0 L "+d+" "+b+" z"},b}(H),I.Crow=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,b,c,d;return d=this.w(),a=this.height(),c=2*d/3,b=a/2,"M 0 "+-b+" L "+d+" 0 L 0 "+b+" L "+c+" 0 z"},b}(H),I.Normal=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,b;return b=this.w(),a=this.height()/2,"M 0 0 L "+b+" "+-a+" L "+b+" "+a+" z"},b}(H),I.Inv=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,b;return b=this.w(),a=this.height()/2,"M 0 "+-a+" L "+b+" 0 L 0 "+a+" z"},b}(H),I.Diamond=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.width=function(){return 40},b.prototype.path=function(){var a,b,c;return b=this.w(),c=b/2,a=this.height()/2,"M 0 0 L "+c+" "+-a+" L "+b+" 0 L "+c+" "+a+" z"},b}(H),I.Dot=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,b,c;return b=this.w(),c=b/2,a=this.height()/2,"M 0 0 A "+-c+" "+a+" 0 1 1 "+b+" 0 A "+-c+" "+a+" 0 1 1 0 0"},b}(H),I.Box=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,b,c;return b=this.w(),c=b/2,a=this.height()/2,"M 0 "+-a+" L 0 "+a+" L "+b+" "+a+" L "+b+" "+-a+" z"},b}(H),I.Tee=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.width=function(){return 7.5},b}(I.Box),Pb=function(a){var b;return b=a.cls.name.toLowerCase(),a.open?"o"+b:b},I._get=function(a,b){var c,d;return null==b&&(b=!1),d=!1,0===a.indexOf("o")&&(a=a.slice(1),d=!0),a=ob(a.replace(/^Black/,"")),c=a&&a in I?new I[a](d,b):new I.None(d,b)},I._cycle=function(a,b){var c,d,e;return null==b&&(b=!1),c=b?"arrowtail":"arrowhead",d=b?"marker_start":"marker_end",e=a.attrs[c]||Pb(a[d]||a.cls[d]),a.attrs[c]=0===e.indexOf("o")?e.slice("1"):"o"+Xb(I,I._get(e,b).cls.name),a[d]=I._get(a.attrs[c],b)},s=function(a){function b(a,c,d,e){this.x=a,this.y=c,this.text=d,this.fixed=null!=e?e:!1,b.__super__.constructor.apply(this,arguments),this.ts=kc(),this.margin={x:10,y:5},this._width=null,this._height=null,this._rotation=0,this.anchors={},this.color=null,this.bg_color=null,this.anchors[pb.N]=function(a){return function(){return{x:a.x,y:a.y-a.height()/2}}}(this),this.anchors[pb.E]=function(a){return function(){return{x:a.x+a.width()/2,y:a.y}}}(this),this.anchors[pb.S]=function(a){return function(){return{x:a.x,y:a.y+a.height()/2}}}(this),this.anchors[pb.W]=function(a){return function(){return{x:a.x-a.width()/2,y:a.y}}}(this),this.handles={NE:function(a){return function(){return{x:a.width()/2,y:-a.height()/2}}}(this),NW:function(a){return function(){return{x:-a.width()/2,y:-a.height()/2}}}(this),SW:function(a){return function(){return{x:-a.width()/2,y:a.height()/2}}}(this),SE:function(a){return function(){return{x:a.width()/2,y:a.height()/2}}}(this),O:function(a){return function(){return{x:0,y:-a.height()/2}}}(this)}}return yc(b,a),b.handle_size=10,b.resizeable=!0,b.rotationable=!0,b.fill="bg",b.stroke="fg",b.prototype.rotate=function(a,b){var c,d;return null==b&&(b=!0),void 0===a.x||void 0===a.y?null:(c=b?this._rotation:2*cc-this._rotation,d={x:a.x-this.x,y:a.y-this.y},d=ec(d,c),d.x+=this.x,d.y+=this.y,d)},b.prototype.anchor_list=function(){return[pb.N,pb.S,pb.W,pb.E]},b.prototype.handle_list=function(){var a;return a=[],this.cls.resizeable&&(a=a.concat(["NW","NE","SW","SE"])),this.cls.rotationable&&a.push("O"),a},b.prototype.pos=function(){return this.rotate({x:this.x,y:this.y})},b.prototype.set_txt_bbox=function(a){return this._txt_bbox=a},b.prototype.txt_width=function(){return this._txt_bbox.width+2*this.margin.x},b.prototype.txt_height=function(){return this._txt_bbox.height+2*this.margin.y},b.prototype.txt_x=function(){return 0},b.prototype.txt_y=function(){var a;return a=this.text.split("\n").length,this.margin.y-this._txt_bbox.height*(a-1)/a/2},b.prototype.width=function(a){var b;return null==a&&(a=null),null!==a?this._width=a:((null!=(b=this.attrs)?b.width:void 0)&&(this._width=this.attrs.width*this.txt_width(),delete this.attrs.width),Math.max(this._width||0,this.txt_width()))},b.prototype.height=function(a){var b;return null==a&&(a=null),null!==a?this._height=a:((null!=(b=this.attrs)?b.height:void 0)&&(this._height=this.attrs.height*this.txt_height(),delete this.attrs.height),Math.max(this._height||0,this.txt_height()))},b.prototype.direction=function(a,b){var c,d,e,f,g,h,i,j,k;h=2*cc,j=mb(b-this.y,a-this.x),g=1/0,k=this.anchors;for(c in k)i=k[c],d=j-+c-this._rotation,e=Math.min(Math.abs(d)%h,Math.abs(d-h)%h),g>e&&(g=e,f=c);return+f},b.prototype["in"]=function(a){var b,c;return b=this.x*diagram.zoom.scale+diagram.zoom.translate[0],c=this.y*diagram.zoom.scale+diagram.zoom.translate[1],a.x<b&&b<a.x+a.width&&a.y<c&&c<a.y+a.height},b.prototype.contains=function(){return!1},b.prototype.objectify=function(){return{name:this.constructor.name,x:this.x,y:this.y,width:this._width,height:this._height,rotation:this._rotation,text:this.text,fixed:this.fixed,attrs:this.attrs}},b}(g),J=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.width=function(){return 1},b.prototype.height=function(){return 1},b.prototype.weight=1,b}(s),D=function(a){function b(a,c,d){this.source=a,this.target=c,b.__super__.constructor.apply(this,arguments),this.a1=this.a2=0,this.text={source:(null!=d?d.source:void 0)||"",target:(null!=d?d.target:void 0)||""},this.color=null}return yc(b,a),b.marker_start=new I.None(!1,!0),b.marker_end=new I.None,b.type="full",b.prototype.text_margin=10,b.prototype.objectify=function(a){return null==a&&(a=diagram.elements),{name:this.constructor.name,source:a.indexOf(this.source),target:a.indexOf(this.target),source_anchor:this.source_anchor,target_anchor:this.target_anchor,text:this.text,attrs:this.attrs}},b.prototype.nearest=function(a){return vb(a,this.a1)<vb(a,this.a2)?this.source:this.target},b.prototype.path=function(){var a,b,c,d;return a=this.source.pos(),b=this.target.pos(),null===a||null===b||void 0===a.x||void 0===a.y||void 0===b.x||void 0===b.y?"M 0 0":(c=null!=this.source_anchor?+this.source_anchor:+this.source.direction(b.x,b.y),this.a1=this.source.rotate(this.source.anchors[c]()),d=null!=this.target_anchor?+this.target_anchor:+this.target.direction(this.a1.x,this.a1.y),this.source===this.target&&c===d&&(d=+Xb(this.target.anchors,c.toString())),this.a2=this.target.rotate(this.target.anchors[d]()),this.o1=c+this.source._rotation,this.o2=d+this.target._rotation,diagram.linkstyle.get(this.source,this.target,this.a1,this.a2,this.o1,this.o2))},b}(g),n=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.title="Untitled "+this.label,this.linkstyle=new F.Rectangular,this.zoom={scale:1,translate:[0,0]},this.elements=[],this.links=[],this.snap={x:25,y:25,a:22.5},this.selection=[],this.linking=[],this.last_types={link:null,element:null},this.force_conf={gravity:.1,distance:20,strengh:1,friction:.9,theta:.8,charge_base:2e3}}return yc(b,a),b.init_types=function(){return{elements:{},links:{}}},b.prototype.start_force=function(){return this.force=d3.layout.force().gravity(this.force_conf.gravity).linkDistance(this.force_conf.distance).linkStrength(this.force_conf.strengh).friction(this.force_conf.friction).theta(this.force_conf.theta).charge(function(a){return function(b){return-a.force_conf.charge_base-b.width()*b.height()/4}}(this)).size([svg.width,svg.height]),this.force.on("tick",function(){return svg.tick()}),this.force.on("end",Gb),svg.sync(),this.force.start()},b.prototype.markers=function(){var a,b,c;b=[];for(c in I)a=I[c],0!==c.indexOf("_")&&(b.push(new a(!1,!1)),b.push(new a(!0,!1)),b.push(new a(!1,!0)),b.push(new a(!0,!0)));return b},b.prototype.to_svg=function(){var a,b,c,d,e,f,g,h,i,j;for(b="",i=d3.select("#style").node().sheet.cssRules,g=0,h=i.length;h>g;g++)e=i[g],(null!=(j=e.selectorText)?j.match(/^svg\s/):void 0)&&(e.cssText.match(/:hover/)||e.cssText.match(/:active/)||e.cssText.match(/transition/)||(b+=e.cssText.replace(/svg\s/g,"")));return f=d3.select(svg.svg.node().cloneNode(!0)),f.select(".background").remove(),f.selectAll(".handles,.anchors").remove(),f.selectAll(".element").classed("selected",!1),f.selectAll(".ghost").remove(),f.select("defs").append("style").text(b),c=50,d=svg.svg.select(".root").node().getBoundingClientRect(),f.select(".root").attr("transform","translate("+(diagram.zoom.translate[0]-d.left+c)+", "+(diagram.zoom.translate[1]-d.top+c)+") scale("+diagram.zoom.scale+")"),f.select("#title").attr("x",d.width/2+c),f.append("image").attr("xlink:href","data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGQAAAAnCAYAAAD5Lu2WAAAABHNCSVQICAgIfAhkiAAAAAl wSFlzAAAEKQAABCkBfcZRfgAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPB oAAAfPSURBVGiB7Zp/bFPXFce/5z7b+QUJPxMYhYSqDQuidKloIAnaaiBpkqKsWcV7L6Vjs K1j7To6pm2q2kko60Q3dWpVtBVYW7VFBOIHBRFo4piiFTFIwo/BYIVN3fhRGHSUEaAhjsHv nv0RbJzEv5KYxs38kSz73nvOuee9r9+75z6bmBkJ4gcx2Akk6E5CkDgjIUickRAkzkgIEmd YojEqamoqgEQZEfVbQGYcuav96nZjwQKzvzH+H6BIZW9xo8vFhJKYTAacvSm9BfsrKj6NRT wflZWVqfX19R2xjDlYOYT9xs9yfjC7pxjFY8fi6dx7oWZPQobV2jsgEeaNH4cfTclF1cSJS FYU/xgDE63C8v2BJh2I3W63pKamXNQ07euxjNufHHRdnzXQWGFvWQqb5Uzkb79w3zQ8MuEr /va3756MH7TsxwW3G0CXGC8/kI/CsWP8NmrOJDzZ0or2m14AAAPlAH490MR95OTkWNzujjQ Ao2IVs785CCFHDDRW2CtECuH/ej8walQ3MQBgdFISnsq919+eMy6rmxgAkJ2WhkWTJ9/uIC hIEJKoF+kp6cOD92ekB9ikB7XJzQjeH88UNDSMC2wTQMUuV+adnjdqQc51BF+vzl3v6JONj 5qamm5z2+12C1HA/bEHS5cu7b1g9ZFIcwAA1dSIQufOSouwXChy7lzg6y90up5jiU9nO51T KCB3VVUVj8eTAQCmSWlVVVUjBpJrVGUvAOz97BKOtl3B9JG3b5M3pcRb//yXv+08fx5adjZ yhqX5+9q9Xqw/dbpXvBMnjtdqmvaxENzKTCuysjKna5p6Q9fV/VLiZ4ZhHCEi0jTtKYCfAZ Cr69o1gPcqiny2tnbzyWjyVlU1hYhWEKEsKyszT9NUj66rxwCsdzg2reGAMrPY6Xq6qKDwU VKwWHr5NcUqWv2BWDiJzDHy84xPCmcWtRQ6XX9oLit9VwhRK6WpAQARNicl2XD1alsrgH4t 8FELIpmx7MBBLMiehOkjR+CSx4P3zpzFyfZ2v43HlHiypRXVOdnITU/HebcbG0+dxn86O3v FI8J4AOXMNBzAGoB+BWAYwEuEoP26ri/UNFUDeD5Arwohd0spMgE8Y5rKUVVVZxuGcSRczq qqThWCtgDIAHg1EQ5JSWlEVAjgVVVVq6qqqtStW7deueWSKQmZzSUl5wH8JDDWvvJ5hwEcB oAi585MAsYDgM12Y5nHY32dCLsBWg6ghUj8O9rz2pOoBQGAG1Ki9tRp1J4KbXPd68WbAVdN BDIAUuvq6jYF9NXpuv4mwA4ALCXPMQzHbt+gqqq1RLRDCHqHiPIXL14cNLCqqilC0GaAz0i JasMwLgcMG6qqviEEvZ+UZFsNoDrahHuybt2Wi0uWLLnmdndACPn3DRuMlv7GAgb90Qm39h ADAKAoys8BMIB6wzB2B44ZhmES0U8B3P/444/dEyqyEOIFAKOEsCzsIYYvznEisRDAAl3X5 w/4UGLEoApCRB8F66+trW0DcAbgw8HG8/Ly/gHAK6WYFjq6nMeMdzZs2HAplMXGjRv3AbwP wLw+JX4HGVRBmHEzzPCNW69erFixQgIwmUVSsPGuSoqmE1HYNeaW7UdE/LWoEv4CGJJPe29 VTpcBOSayLY1kxohbflcIyIhihuCbshgwJAXpgg8z0zfCWdjtdguAB/0exEcA5MzctWt0KJ 9ZjY13ocdjGpvNZgJgZqQMLOchLAgzrSbCY7qul4ayGTcu85cA3+1rdwhxAMAFi9d8MZSPI MvKnn1r1669CeACM1UMNO8hK4jD4WgAaA3AhqZp3w0cq6ioSNI07WVmPA/AX6P/tbT0OjOW MuOHxY1Nv7V/+GGyb2zGjh2pxU7XKoCfAODtPSPtAfAtXdfDFBqR6dM+JJ4hwjJd12c6HI7 nfbtvKeWPiegsEVbruvYiwH8BKC09fXg+gOtScgkRlROhzBenubx0e7Fz5yImrPJ03vhekb PpIDEJm8U2g0HXwLCD8G5XVX4bKeUvhKA9AB/Tde0EQL+pq6tb19fjCCtIxF+v+gGz70j4j 8x0MYzl74mUvWHGVyqKt/ntt+s6dV1/BcAEZu5WdRmGYQJ4Sdf195h5DhHdB1AbgFfcbvfu bdu2fV5dXd3JzN22unvLStYXNDR8oCjW+YIxnQmdDLkmOTnZ9aeHHmovdLpeY8hdPeb6pLK yMi8lJWURgDwhpHXGoUNW22eX5zPJrFBHoZji4J8rSg762mHPeZFzZxXAW0KflL7DwKrmst JnYxkznpi2aZNt+LCMuc3lpY1FTtdzAF6K4MKKqdyz55G5J4EIa0hSsnU7gHMxyhUAJLO5N obx4o6MtBFTifB+UZNrK4imRuFCpsWb629EuivNrq8fblqTn6Cun3Lz+58qXybQCQbaI9t+ qRkNwjeJIZnQCMajET2Iy/c9/LCz62Piv70xpdjlmsYSR5ixkAjlAL4T0SlAkCFb9g4We0t L/2Zalazm8lJHf/wTgtwBWufO/W9/fROCfAHkjxqJ5XlfxYTUVKzMvx/DLBa8XvBgUNshsz GMZw5fbsPxq1fhMSVqjh6Dx5RYfuhQUNvEFXIHYcbHvs8eUwZ9B8BSCP/jm8QVcgcZCfN3V 2A5CQ69U2eIAy0lJX7hEmVvnJG4ZcUZCUHijIQgccb/AGU94E0OVgKPAAAAAElFTkSuQmCC").attr("x",10).attr("width",100).attr("y",d.height+50).attr("height",39),a=f.html(),null==a&&(a=$(f.node()).wrap("<div>").parent().html()),"<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='"+(d.width+2*c)+"' height='"+(d.height+2*c)+"'> <!-- Generated with umlaut (http://kozea.github.io/umlaut/) (c) Mounier Florian Kozea 2013 on "+(new Date).toString()+"--> "+a+" </svg>"},b.prototype.objectify=function(){return{name:this.constructor.name,title:this.title,linkstyle:this.linkstyle.cls.name,zoom:this.zoom,elements:this.elements.map(function(a){return a.objectify()}),links:this.links.map(function(a){return a.objectify()}),force:this.force?!0:!1}},b.prototype.hash=function(){return LZString.compressToBase64(JSON.stringify(this.objectify()))},b.prototype.loads=function(a){var b,c,d,e,f,g,h,i;for(a.title&&(this.title=a.title),a.linkstyle&&(this.linkstyle=new(F[ob(a.linkstyle)])),a.zoom&&(this.zoom=a.zoom),h=a.elements,d=0,f=h.length;f>d;d++)b=h[d],this.elements.push(this.elementify(b));for(i=a.links,e=0,g=i.length;g>e;e++)c=i[e],this.links.push(this.linkify(c));return a.force?this.start_force():void 0},b.prototype.elementify=function(a){var b,c;return c=this.types.elements[a.name],b=new c(a.x,a.y,a.text,!1),b._width=a.width||null,b._height=a.height||null,b._rotation=a.rotation||0,b.attrs=_b(a.attrs||{}),b},b.prototype.linkify=function(a,b){var c,d;return null==b&&(b=this.elements),d=this.types.links[a.name]||this.types.links.Link,c=new d(b[a.source],b[a.target],a.text),c.source_anchor=a.source_anchor,c.target_anchor=a.target_anchor,c.attrs=_b(a.attrs||{}),c.attrs.arrowhead&&(c.marker_end=I._get(c.attrs.arrowhead)),c.attrs.arrowtail&&(c.marker_start=I._get(c.attrs.arrowtail,!0)),c},b}(g),o={_get:function(a){return this[a]||this[a.replace("Diagram","")]}},ab=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,b;return b=this.width()/2,a=this.height()/2,"M "+-b+" "+-a+" L "+b+" "+-a+" L "+b+" "+a+" L "+-b+" "+a+" z"},b}(s),t=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.txt_width=function(){return 2*b.__super__.txt_width.call(this)/Math.sqrt(2)},b.prototype.txt_height=function(){return 2*b.__super__.txt_height.call(this)/Math.sqrt(2)},b.prototype.path=function(){var a,b;return b=this.width()/2,a=this.height()/2,"M "+-b+" 0 A "+b+" "+a+" 0 1 1 "+b+" 0 A "+b+" "+a+" 0 1 1 "+-b+" 0"},b}(s),L=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.shift=15,b.prototype.txt_width=function(){return b.__super__.txt_width.call(this)+this.shift},b.prototype.txt_x=function(){return b.__super__.txt_x.call(this)-this.shift/2},b.prototype.txt_y=function(){return b.__super__.txt_y.call(this)},b.prototype.path=function(){var a,b;return b=this.width()/2,a=this.height()/2,"M "+-b+" "+-a+" L "+(b-this.shift)+" "+-a+" L "+b+" "+(-a+this.shift)+" L "+b+" "+a+" L "+-b+" "+a+" L "+-b+" "+(-a+this.shift)+" z M "+b+" "+(-a+this.shift)+" L "+(b-this.shift)+" "+(-a+this.shift)+" L "+(b-this.shift)+" "+-a},b}(s),G=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.txt_width=function(){var a;return a=b.__super__.txt_width.call(this),a+Math.sqrt(a*this["super"]("txt_height",b))},b.prototype.txt_height=function(){var a;return a=b.__super__.txt_height.call(this),a+Math.sqrt(a*this["super"]("txt_width",b))},b.prototype.path=function(){var a,b;return b=this.width()/2,a=this.height()/2,"M "+-b+" 0 L 0 "+-a+" L "+b+" 0 L 0 "+a+" z"},b}(s),jb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.txt_width=function(){return 2*b.__super__.txt_width.call(this)},b.prototype.txt_height=function(){return 2*b.__super__.txt_height.call(this)},b.prototype.txt_y=function(){return b.__super__.txt_y.call(this)+this.txt_height()/4},b.prototype.path=function(){var a,b;return b=this.width()/2,a=this.height()/2,"M 0 "+-a+" L "+b+" "+a+" L "+-b+" "+a+" z"},b}(s),R=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.anchors[pb.E]=function(a){return function(){return{x:a.x+a.width()/2-a.height()/4,y:a.y}}}(this),this.anchors[pb.W]=function(a){return function(){return{x:a.x-a.width()/2+a.height()/4,y:a.y}}}(this)}return yc(b,a),b.prototype.txt_width=function(){return b.__super__.txt_width.call(this)+this.height()},b.prototype.path=function(){var a,b,c;return c=(this.width()-this.height())/2,a=this.height()/2,b=this.width()/2,"M "+-b+" "+-a+" L "+c+" "+-a+" L "+b+" "+a+" L "+-c+" "+a+" z"},b}(s),ib=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,b,c;return c=(this.width()-this.height())/2,a=this.height()/2,b=this.width()/2,"M "+-c+" "+-a+" L "+c+" "+-a+" L "+b+" "+a+" L "+-b+" "+a+" z"},b}(R),x=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.anchors[pb.N]=function(a){return function(){return{x:a.x,y:a.y-3*a.shift_height()/2}}}(this),this.anchors[pb.W]=function(a){return function(){return{x:a.x-a.width()/2,y:a.y+a.shift_height()/2}}}(this),this.anchors[pb.E]=function(a){return function(){return{x:a.x+a.width()/2,y:a.y+a.shift_height()/2}}}(this)}return yc(b,a),b.prototype.shift=1.5,b.prototype.shift_height=function(){return this.height()*(this.shift-1)/this.shift},b.prototype.txt_height=function(){return b.__super__.txt_height.call(this)*this.shift},b.prototype.txt_y=function(){return b.__super__.txt_y.call(this)+this.shift_height()/2},b.prototype.path=function(){var a,b,c;return c=this.width()/2,a=this.height()/2,b=a-this.shift_height(),"M "+-c+" "+-b+" L 0 "+-a+" L "+c+" "+-b+" L "+c+" "+a+" L "+-c+" "+a+" z"},b}(s),U=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.anchors[pb.N]=function(a){return function(){return{x:a.x+a._x(0),y:a.y+a._y(0)}}}(this),this.anchors[pb.E]=function(a){return function(){return{x:a.x+a._x(cc/2),y:a.y+a._y(cc/2)}}}(this),this.anchors[pb.S]=function(a){return function(){return{x:a.x+a._x(cc),y:a.y+a._y(cc)}}}(this),this.anchors[pb.W]=function(a){return function(){return{x:a.x+a._x(3*cc/2),y:a.y+a._y(3*cc/2)}}}(this)}return yc(b,a),b.prototype.n=4,b.prototype.shift=cc/4,b.prototype._x=function(a){var b,c,d;return b=cc/this.n,d=this.width()/2,c=d*(Math.cos(b)/Math.cos((a+this.shift)%(2*b)-b))*Math.cos(a-cc/2)},b.prototype._y=function(a){var b,c,d;return c=cc/this.n,b=this.height()/2,d=b*(Math.cos(c)/Math.cos((a+this.shift)%(2*c)-c))*Math.sin(a-cc/2)},b.prototype.txt_width=function(){return 2*b.__super__.txt_width.call(this)},b.prototype.txt_height=function(){return 2*b.__super__.txt_height.call(this)},b.prototype.path=function(){var a,b,c,d,e,f,g;for(e=this.width()/2,b=this.height()/2,a=2*cc/this.n,d="",c=f=0,g=this.n;g>=0?g>=f:f>=g;c=g>=0?++f:--f)d=""+d+" "+(0===c?"M":"L")+" "+e*Math.sin(c*a+this.shift)+" "+-b*Math.cos(c*a+this.shift);return""+d+" z"},b}(s),jb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.n=3,b.prototype.shift=0,b}(U),T=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.n=5,b.prototype.shift=0,b}(U),w=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.n=6,b.prototype.shift=cc/6,b}(U),bb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.n=7,b.prototype.shift=0,b}(U),O=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.n=8,b.prototype.shift=cc/8,b}(U),cb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.txt_width=function(){return 5*b.__super__.txt_width.call(this)*cc/7.5},b.prototype.txt_height=function(){return 5*b.__super__.txt_height.call(this)*cc/7.5},b.prototype.path=function(){var a,b,c,d,e,f,g,h,i,j;for(a=2*cc/this.n,h=this.width()/2,b=this.height()/2,f=5*cc/6,e=h/f,d=b/f,g="M 0 "+-b,c=i=0,j=this.n;j>=0?j>=i:i>=j;c=j>=0?++i:--i)g=""+g+" L "+h*Math.sin(c*a)+" "+-b*Math.cos(c*a)+" L "+e*Math.sin((c+.5)*a)+" "+-d*Math.cos((c+.5)*a);return""+g+" z"},b}(T),c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.marker_end=new I.Normal,b}(D),z=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.marker_end=new I.Normal(!0),b}(D),k=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.marker_end=new I.Diamond,b}(D),j=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.marker_end=new I.Vee,b.type="dashed",b}(D),a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.marker_end=new I.Diamond(!0),b}(D),v=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.contains=function(a){var b,c,d,e;return c=this.width()/2,b=this.height()/2,this.x-c<(d=a.x)&&d<this.x+c&&this.y-b<(e=a.y)&&e<this.y+b},b.prototype.txt_y=function(){var a;return a=this.text.split("\n").length,this.margin.y-this.height()/2+this._txt_bbox.height-this._txt_bbox.height*(a-1)/a},b.prototype.path=function(){var a,b,c;return c=this.width()/2,a=this.height()/2,b=-a+this.txt_height()+this.margin.y,"M "+-c+" "+-a+" L "+c+" "+-a+" L "+c+" "+b+" L "+-c+" "+b+" z M "+c+" "+b+" L "+c+" "+a+" M "+-c+" "+b+" L "+-c+" "+a+" M "+-c+" "+a+" L "+c+" "+a},b}(s),o.FlowChart=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.label="Flow Chart",b.prototype.types=b.init_types(),b}(n),p=o.FlowChart.prototype.types.elements,p.Process=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(ab),p.IO=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(R),p.Terminator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,b,c;return c=this.width()/2,a=this.height()/2,b=Math.min(c/2,a/2),"M "+(-c+b)+" "+-a+" L "+(c-b)+" "+-a+" Q "+c+" "+-a+" "+c+" "+(-a+b)+" L "+c+" "+(a-b)+" Q "+c+" "+a+" "+(c-b)+" "+a+" L "+(-c+b)+" "+a+" Q "+-c+" "+a+" "+-c+" "+(a-b)+" L "+-c+" "+(-a+b)+" Q "+-c+" "+-a+" "+(-c+b)+" "+-a},b}(s),p.Decision=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(G),p.Delay=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.anchors[pb.N]=function(a){return function(){return{x:a.x+a.txt_x(),y:a.y-a.height()/2}}}(this),this.anchors[pb.S]=function(a){return function(){return{x:a.x+a.txt_x(),y:a.y+a.height()/2}}}(this)}return yc(b,a),b.prototype.txt_x=function(){return b.__super__.txt_x.call(this)-this.height()/4+this.txt_height()/6},b.prototype.txt_width=function(){return Math.max(0,b.__super__.txt_width.call(this)-this.txt_height()/3)+this.height()/2},b.prototype.path=function(){var a,b;return b=this.width()/2,a=this.height()/2,"M "+-b+" "+-a+" L "+(b-a)+" "+-a+" A "+a+" "+a+" 0 1 1 "+(b-a)+" "+a+" L "+-b+" "+a+" z"},b}(s),p.SubProcess=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.shift=1.2,b.prototype.txt_width=function(){return b.__super__.txt_width.call(this)*this.shift},b.prototype.shift_width=function(){return this.width()*(this.shift-1)/this.shift},b.prototype.path=function(){var a,c,d;return d=this.width()/2,c=d-this.shift_width()/2,a=this.height()/2,""+b.__super__.path.call(this)+" M "+-c+" "+-a+" L "+-c+" "+a+" M "+c+" "+-a+" L "+c+" "+a},b}(p.Process),p.Document=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.txt_height=function(){return 1.25*b.__super__.txt_height.call(this)},b.prototype.txt_y=function(){return b.__super__.txt_y.call(this)-this.height()/16},b.prototype.path=function(){var a,b;return b=this.width()/2,a=this.height()/2,"M "+-b+" "+-a+" L "+b+" "+-a+" L "+b+" "+a+" Q "+b/2+" "+a/2+" 0 "+a+" T "+-b+" "+a+" z"},b}(s),p.Database=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.txt_y=function(){return b.__super__.txt_y.call(this)+this.radius()/2},b.prototype.txt_height=function(){return b.__super__.txt_height.call(this)+20},b.prototype.radius=function(){return Math.min((this.height()-this["super"]("txt_height"))/4,this.width()/3)},b.prototype.path=function(){var a,b,c;return c=this.width()/2,a=this.height()/2,b=this.radius(),"M "+-c+" "+(-a+b)+" A "+c+" "+b+" 0 1 1 "+c+" "+(-a+b)+" A "+c+" "+b+" 0 1 1 "+-c+" "+(-a+b)+" M "+c+" "+(-a+b)+" L "+c+" "+(a-b)+" A "+c+" "+b+" 0 1 1 "+-c+" "+(a-b)+" L "+-c+" "+(-a+b)},b}(s),p.HardDisk=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.txt_x=function(){return b.__super__.txt_x.call(this)-this.radius()/2},b.prototype.txt_width=function(){return b.__super__.txt_width.call(this)+20},b.prototype.radius=function(){return Math.min((this.width()-this["super"]("txt_width"))/4,this.height()/3)},b.prototype.path=function(){var a,b,c;return c=this.width()/2,a=this.height()/2,b=this.radius(),"M "+(c-b)+" "+a+" A "+b+" "+a+" 0 1 1 "+(c-b)+" "+-a+" A "+b+" "+a+" 0 1 1 "+(c-b)+" "+a+" L "+(-c+b)+" "+a+" A "+b+" "+a+" 0 1 1 "+(-c+b)+" "+-a+" L "+(c-b)+" "+-a},b}(s),p.ManualInput=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.anchors[pb.N]=function(a){return function(){return{x:a.x,y:a.y-a.shift_height()/2}}}(this),this.anchors[pb.W]=function(a){return function(){return{x:a.x-a.width()/2,y:a.y+a.shift_height()/2}}}(this)}return yc(b,a),b.prototype.shift=2,b.prototype.shift_height=function(){return this.height()*(this.shift-1)/this.shift},b.prototype.txt_height=function(){return b.__super__.txt_height.call(this)*this.shift},b.prototype.txt_y=function(){return b.__super__.txt_y.call(this)+this.shift_height()/2},b.prototype.path=function(){var a,b,c;
return c=this.width()/2,a=this.height()/2,b=a-this.shift_height(),"M "+-c+" "+-b+" L "+c+" "+-a+" L "+c+" "+a+" L "+-c+" "+a+" z"},b}(s),p.Preparation=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(w),p.InternalStorage=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.hshift=1.5,b.prototype.wshift=1.1,b.prototype.txt_x=function(){return b.__super__.txt_x.call(this)+this.shift_width()/2},b.prototype.txt_y=function(){return b.__super__.txt_y.call(this)+this.shift_height()/2},b.prototype.txt_width=function(){return b.__super__.txt_width.call(this)*this.wshift},b.prototype.txt_height=function(){return b.__super__.txt_height.call(this)*this.hshift},b.prototype.shift_width=function(){return this.width()*(this.wshift-1)/this.wshift},b.prototype.shift_height=function(){return this.height()*(this.hshift-1)/this.hshift},b.prototype.path=function(){var a,c,d,e;return e=this.width()/2,d=e-this.shift_width(),a=this.height()/2,c=a-this.shift_height(),""+b.__super__.path.call(this)+" M "+-d+" "+-a+" L "+-d+" "+a+" M "+-e+" "+-c+" L "+e+" "+-c},b}(p.Process),o.FlowChart.prototype.types.links.Flow=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.marker_end=new I.Normal,b}(D),o.FlowChart.prototype.types.elements.Container=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(v),o.Dot=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.linkstyle=new F.Curve}return yc(b,a),b.prototype.label="Dot diagram",b.prototype.types=b.init_types(),b.prototype.markers=function(){var a,b,c;b=[];for(c in I)a=I[c],0!==c.indexOf("_")&&(b.push(new a),b.push(new a(!0)),b.push(new a(!1,!0)),b.push(new a(!0,!0)));return b},b.prototype.to_dot=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(b=!1,c="graph umlaut {\n",n=diagram.elements,j=0,l=n.length;l>j;j++){d=n[j],c=""+c+'  "'+d.text+'"',a=[],h=d.cls.name.toLowerCase(),"ellipse"!==h&&a.push("shape="+h),d.width()!==d.txt_width()&&a.push("width="+d.width()/d.txt_width()),d.height()!==d.txt_height()&&a.push("height="+d.height()/d.txt_height()),diagram.force||a.push('pos="'+d.x.toFixed()+", "+d.y.toFixed()+(d.fixed?"!":"")+'"'),o=d.attrs;for(e in o)i=o[e],"shape"!==e&&"label"!==e&&a.push(""+e+'="'+i+'"');a.length&&(c=""+c+"["+a.join(",")+"]"),c=""+c+";\n"}for(p=diagram.links,k=0,m=p.length;m>k;k++){f=p[k],f.marker_end?(g="->",b=!0):g="--",c=""+c+'  "'+f.source.text+'" '+g+' "'+f.target.text+'"',a=[],f.marker_start&&a.push("arrowhead="+Pb(f.marker_start)),f.marker_end&&a.push("arrowtail="+Pb(f.marker_end)),f.text.source&&a.push('taillabel="'+f.text.source+'"'),f.text.target&&a.push('headlabel="'+f.text.target+'"'),q=f.attrs;for(e in q)i=q[e],"arrowhead"!==e&&"arrowtail"!==e&&"headlabel"!==e&&"taillabel"!==e&&a.push(""+e+'="'+i+'"');a.length&&(c=""+c+"["+a.join(",")+"]"),c=""+c+";\n"}return c=""+c+"}",b&&(c="di"+c),c},b}(n),p=o.Dot.prototype.types.elements,C=o.Dot.prototype.types.links,p.Box=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(ab),p.Polygon=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(U),p.Ellipse=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(t),p.Oval=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.alias=!0,b}(p.Ellipse),p.Circle=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.txt_height=function(){return Math.max(b.__super__.txt_height.call(this),this["super"]("txt_width"))},b.prototype.txt_width=function(){return Math.max(b.__super__.txt_width.call(this),this["super"]("txt_height"))},b}(p.Ellipse),p.Point=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.margin.x=0,this.margin.y=0,this.text=""}return yc(b,a),b.fill="fg",b.prototype.txt_width=function(){return 5},b.prototype.txt_height=function(){return 5},b.prototype.path=function(){var a,b;return b=this.width()/2,a=this.height()/2,"M 0 "+-a+" A "+b+" "+a+" 0 0 1 0 "+a+" A "+b+" "+a+" 0 0 1 0 "+-a},b}(s),p.Egg=function(a){function b(){var a;b.__super__.constructor.apply(this,arguments),a=1.051,this.anchors[pb.E]=function(b){return function(){return{x:b.x+a*b.width()/(4-b.shift),y:b.y+b.height()/8}}}(this),this.anchors[pb.W]=function(b){return function(){return{x:b.x-a*b.width()/(4-b.shift),y:b.y+b.height()/8}}}(this)}return yc(b,a),b.prototype.shift=1.5,b.prototype.path=function(){var a,b;return b=this.width()/2,a=this.height()/2,"M 0 "+-a+" C "+b/this.shift+" "+-a+" "+b*this.shift+" "+a+" 0 "+a+" C "+-b*this.shift+" "+a+" "+-b/this.shift+" "+-a+" 0 "+-a},b}(p.Ellipse),p.Triangle=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(jb),p.Plaintext=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){return"M 0 0"},b}(s),p.Diamond=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(G),p.Trapezium=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(ib),p.Parallelogram=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(R),p.House=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(x),p.Pentagon=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(T),p.Hexagon=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(w),p.Septagon=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(bb),p.Octogon=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(O),p.Rect=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.alias=!0,b}(p.Box),p.Rectangle=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.alias=!0,b}(p.Box),p.Square=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.txt_height=function(){return Math.max(b.__super__.txt_height.call(this),this["super"]("txt_width"))},b.prototype.txt_width=function(){return Math.max(b.__super__.txt_width.call(this),this["super"]("txt_height"))},b}(p.Box),p.Star=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(cb),p.None=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.alias=!0,b}(p.Plaintext),p.Underline=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,b;return b=this.width()/2,a=this.height()/2,"M "+-b+" "+a+" L "+b+" "+a},b}(s),p.Note=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(L),C.Link=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(D),o.UseCase=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.linkstyle=new F.Diagonal}return yc(b,a),b.prototype.label="UML Use Case Diagram",b.prototype.types=b.init_types(),b}(n),o.UseCase.prototype.types.elements.Case=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(t),o.UseCase.prototype.types.elements.Actor=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.anchors[pb.E]=function(a){return function(){return{x:a.x+(a.width()-a["super"]("txt_width"))/2,y:a.y}}}(this),this.anchors[pb.W]=function(a){return function(){return{x:a.x-(a.width()-a["super"]("txt_width"))/2,y:a.y}}}(this)}return yc(b,a),b.prototype.txt_y=function(){return this.height()/2-this["super"]("txt_height")+2+4*this.margin.y},b.prototype.txt_height=function(){return b.__super__.txt_height.call(this)+50},b.prototype.txt_width=function(){return b.__super__.txt_width.call(this)+25},b.prototype.path=function(){var a,b,c;return c=(this.width()-this["super"]("txt_width"))/2,b=(this.height()-this["super"]("txt_height"))/4,a=this.txt_y()-4*this.margin.y,"M "+-c+" "+a+" L 0 "+(a-b)+" M "+c+" "+a+" L 0 "+(a-b)+" M 0 "+(a-b)+" L 0 "+(a-2*b)+" M "+-c+" "+(a-1.75*b)+" L "+c+" "+(a-2.25*b)+" M 0 "+(a-2*b)+" L 0 "+(a-3*b)+" A "+.5*c+" "+.5*b+" 0 1 1 0 "+(a-4*b)+" A "+.5*c+" "+.5*b+" 0 1 1 0 "+(a-3*b)},b}(s),o.UseCase.prototype.types.elements.System=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(v),o.UseCase.prototype.types.links.Association=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(c),o.UseCase.prototype.types.links.Inheritance=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(z),o.UseCase.prototype.types.links.Aggregation=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(a),o.UseCase.prototype.types.links.Composition=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(k),o.UseCase.prototype.types.links.Comment=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(j),o.Electric=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.linkstyle=new F.Rectangular,this.snap.a=90}return yc(b,a),b.prototype.label="Electric Diagram",b.prototype.types=b.init_types(),b}(n),p=o.Electric.prototype.types.elements,r=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.resizeable=!1,b.rotationable=!0,b.prototype.anchor_list=function(){return nb([pb.W,pb.E],this)},b.prototype.base_height=function(){return 20},b.prototype._base_width=function(){return 20},b.prototype.base_width=function(){return this._base_width()+2*this.wire_margin()},b.prototype.wire_margin=function(){return 10},b.prototype.txt_y=function(){return this.height()/2+3*this.margin.y},b.prototype.txt_height=function(){return this.base_height()},b.prototype.txt_width=function(){return this.base_width()},b}(s),p.Junction=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.margin.x=0,this.margin.y=0,this.text=""}return yc(b,a),b.fill="fg",b.prototype.base_width=function(){return this._base_width()/4},b.prototype.base_height=function(){return b.__super__.base_height.call(this)/4},b.prototype.anchor_list=function(){return nb([pb.N,pb.S,pb.W,pb.E],this)},b.prototype.path=function(){var a,b;return b=this.width()/2,a=this.height()/2,"M 0 "+-a+" A "+b+" "+a+" 0 0 1 0 "+a+" A "+b+" "+a+" 0 0 1 0 "+-a},b}(r),p.Resistor=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.fill="none",b.prototype._base_width=function(){return 3*b.__super__._base_width.call(this)},b.prototype.path=function(){var a,b,c,d,e,f;for(e=this.width()/2,a=this.height()/2,b=e-this.wire_margin(),c="M "+-e+" 0 L "+-b+" 0",d=f=-3;2>=f;d=++f)c=""+c+" L "+(b*d/3+b/6)+" "+a*(d%2?-1:1);return""+c+" L "+b+" 0 L "+e+" 0"},b}(r),p.Diode=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,b,c;return c=this.width()/2,a=this.height()/2,b=c-this.wire_margin(),"M "+-c+" 0 L "+-b+" 0 M "+-b+" "+-a+" L "+b+" 0 L "+b+" "+-a+" L "+b+" "+a+" L "+b+" 0 L "+-b+" "+a+" z M "+b+" 0 L "+c+" 0"},b}(r),p.Battery=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.fill="fg",b.prototype._base_width=function(){return b.__super__._base_width.call(this)/3},b.prototype.base_height=function(){return 2*b.__super__.base_height.call(this)},b.prototype.path=function(){var a,b,c,d,e;return e=this.width()/2,c=e-this.wire_margin(),d=c/2,a=this.height()/2,b=a/2,"M "+-e+" 0 L "+-c+" 0 M "+-c+" "+-b+" L "+-d+" "+-b+" L "+-d+" "+b+" L "+-c+" "+b+" z M "+c+" "+-a+" L "+c+" "+a+" M "+c+" 0 L "+e+" 0"},b}(r),hb=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.anchors[pb.N]=function(a){return function(){return{x:a.x+.6*(a.width()/2-a.wire_margin()),y:a.y-a.height()/2}}}(this),this.anchors[pb.S]=function(a){return function(){return{x:a.x+.6*(a.width()/2-a.wire_margin()),y:a.y+a.height()/2}}}(this)}return yc(b,a),b.prototype.base_width=function(){return 2*this._base_width()+2*this.wire_margin()},b.prototype.base_height=function(){return 2*b.__super__.base_height.call(this)+2*this.wire_margin()},b.prototype.anchor_list=function(){return nb([pb.W,pb.N,pb.S],this)},b.prototype.wire_margin=function(){return b.__super__.wire_margin.call(this)},b.prototype.path=function(){var a,b,c,d,e,f,g,h,i;return g=this.width()/2,a=this.height()/2,f=g-this.wire_margin(),e=a-this.wire_margin(),h=f/4,b=.6*e,c=b/2,i=.6*f,d=.8*e,"M "+-g+" 0 L "+-f+" 0 A "+f+" "+f+" 0 1 1 "+f+" 0 A "+f+" "+f+" 0 1 1 "+-f+" 0 L "+-h+" 0 M "+-h+" "+-b+" L "+-h+" "+b+" M "+-h+" "+-c+" L "+i+" "+-d+" M "+i+" "+-d+" L "+i+" "+-a+" M "+-h+" "+c+" L "+i+" "+d+" L "+i+" "+a},b}(r),p.PNPTransistor=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,c,d,e,f,g,h,i,j,k;return h=this.width()/2,a=this.height()/2,g=h-this.wire_margin(),f=a-this.wire_margin(),k=.6*g,e=.8*f,i=.1*g,c=.7*f,j=.3*g,d=.4*f,""+b.__super__.path.call(this)+" M "+k+" "+-e+" L "+i+" "+-c+" M "+k+" "+-e+" L "+j+" "+-d},b}(hb),p.NPNTransistor=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.path=function(){var a,c,d,e,f,g,h,i,j,k;return h=this.width()/2,a=this.height()/2,g=h-this.wire_margin(),f=a-this.wire_margin(),k=.6*g,e=.8*f,i=.1*g,c=.7*f,j=.3*g,d=.4*f,""+b.__super__.path.call(this)+" M "+k+" "+e+" L "+i+" "+c+" M "+k+" "+e+" L "+j+" "+d},b}(hb),o.Electric.prototype.types.links.Wire=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(D),o.Class=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.linkstyle=new F.Diagonal}return yc(b,a),b.prototype.label="UML Class Diagram",b.prototype.types=b.init_types(),b}(n),o.Class.prototype.types.elements.Note=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(L),o.Class.prototype.types.elements.Class=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b.prototype.shift=10,b.prototype.height=function(){return b.__super__.height.call(this)+2*this.shift},b.prototype.txt_y=function(){return b.__super__.txt_y.call(this)-this.shift},b.prototype.path=function(){var a,c;return c=this.width()/2,a=this.height()/2,""+b.__super__.path.call(this)+" M "+-c+" "+(a-this.shift)+" L "+c+" "+(a-this.shift)+" M "+-c+" "+(a-2*this.shift)+" L "+c+" "+(a-2*this.shift)},b}(ab),o.Class.prototype.types.elements.System=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(v),C=o.Class.prototype.types.links,C.Association=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(c),C.Inheritance=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(z),C.Aggregation=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(a),C.Composition=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(k),C.Comment=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(j),ac=function(a,b){return d3.ascending(a.ts,b.ts)},Yb=function(a,b,c){var d,e,f;return d=diagram.types.elements[a],diagram.last_types.element=d,f=diagram.elements.filter(function(a){return a instanceof d}).length+1,e=new d(b,c,""+a+" #"+f,!diagram.force),diagram.elements.push(e),d3.event&&(diagram.selection=[e]),svg.sync(!0)},dc=function(a){var b,c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],wc.call(diagram.elements,c)>=0?diagram.elements.splice(diagram.elements.indexOf(c),1):wc.call(diagram.links,c)>=0&&diagram.links.splice(diagram.links.indexOf(c),1),f.push(function(){var a,d,e,f;for(e=diagram.links.slice(),f=[],a=0,d=e.length;d>a;a++)b=e[a],f.push(c===b.source||c===b.target?diagram.links.splice(diagram.links.indexOf(b),1):void 0);return f}());return f},rb={elements:[],links:[]},ub=function(){return tb(),dc(diagram.selection),diagram.selection=[],svg.sync(!0),!1},tb=function(){var a,b,c,d,e,f,g,h,i,j;for(rb.elements=[],rb.links=[],a=[],g=diagram.selection,c=0,e=g.length;e>c;c++)b=g[c],wc.call(diagram.elements,b)>=0&&(rb.elements.push(b.objectify()),a.push(b));for(h=diagram.selection,d=0,f=h.length;f>d;d++)b=h[d],wc.call(diagram.links,b)>=0&&(i=b.source,wc.call(diagram.selection,i)>=0&&(j=b.target,wc.call(diagram.selection,j)>=0)&&rb.links.push(b.objectify(a)));return!1},bc=function(){var a,b,c,d,e,f,g,h,i,j,k;for(b=[],diagram.selection=[],e=diagram.force?{x:0,y:0}:{x:Math.round(50*(2*Math.random()-1)),y:Math.round(50*(2*Math.random()-1))},j=rb.elements,f=0,h=j.length;h>f;f++)d=j[f],a=diagram.elementify(d),a.x+=e.x,a.y+=e.y,diagram.elements.push(a),b.push(a),diagram.selection.push(a);for(k=rb.links,g=0,i=k.length;i>g;g++)d=k[g],c=diagram.linkify(d,b),diagram.links.push(c),diagram.selection.push(c);return svg.sync(!0),!1},Jb={fun:null,args:null},tc=function(a){return function(){return $("#overlay").hasClass("visible")?void("esc"===arguments[1]&&$("#overlay").click()):(Jb={fun:a,args:arguments},a.apply(this,arguments))}},sb={undo:{fun:function(a){return history.go(-1),null!=a?a.preventDefault():void 0},label:"Undo",glyph:"chevron-left",hotkey:"ctrl+z"},redo:{fun:function(a){return history.go(1),null!=a?a.preventDefault():void 0},label:"Redo",glyph:"chevron-right",hotkey:"ctrl+y"},save:{fun:function(a){return svg.sync(!0),fc(),null!=a?a.preventDefault():void 0},label:"Save locally",glyph:"save",hotkey:"ctrl+s"},"export":{fun:function(){var a,b;return b=diagram.to_svg(),$("body").append(a=$("<a>",{href:URL.createObjectURL(new Blob([b],{type:"image/svg+xml"})),download:""+diagram.title+".svg"})),a[0].click(),a.remove()},label:"Export to svg",glyph:"export",hotkey:"ctrl+enter"},export_to_textile:{fun:function(){return zb(function(){return"!data:image/svg+xml;base64,"+btoa(diagram.to_svg())+"!:http://kozea.github.io/umlaut/"+location.hash},function(){return null})},hotkey:"ctrl+b"},export_to_markdown:{fun:function(a){return zb(function(){return"[!["+diagram.title+"]["+diagram.title+" - base64]]["+diagram.title+" - umlaut_url]\n\n["+diagram.title+" - base64]: data:image/svg+xml;base64,"+btoa(diagram.to_svg())+"\n["+diagram.title+" - umlaut_url]: http://kozea.github.io/umlaut/"+location.hash},function(){return null}),a.preventDefault()},hotkey:"ctrl+m ctrl+d"},edit:{fun:function(){return zb(function(){var a,b,c;return 1===diagram.selection.length?(a=diagram.selection[0],[a.text,null!=(b=a.attrs)?b.color:void 0,null!=(c=a.attrs)?c.fillcolor:void 0]):["","#ffffff","#000000"]},function(a){var b,c,d,e,f;for(e=diagram.selection,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.text=a);return f})},label:"Edit elements text",glyph:"edit",hotkey:"e"},remove:{fun:function(){return dc(diagram.selection),diagram.selection=[],svg.sync(!0)},label:"Remove elements",glyph:"remove-sign",hotkey:"del"},select_all:{fun:function(a){return diagram.selection=diagram.elements.concat(diagram.links),svg.tick(),null!=a?a.preventDefault():void 0},label:"Select all elements",glyph:"fullscreen",hotkey:"ctrl+a"},force:{fun:function(a){return diagram.force?(diagram.force.stop(),void(diagram.force=null)):(diagram.start_force(),null!=a?a.preventDefault():void 0)},label:"Toggle force",glyph:"send",hotkey:"tab"},linkstyle:{fun:function(){return diagram.linkstyle=new(F[Xb(F,diagram.linkstyle.cls.name)]),svg.tick()},label:"Change link style",glyph:"retweet",hotkey:"space"},defaultscale:{fun:function(){return diagram.zoom.scale=1,diagram.zoom.translate=[0,0],svg.sync(!0)},label:"Reset view",glyph:"screenshot",hotkey:"ctrl+backspace"},snaptogrid:{fun:function(){var a,b,c,d;for(d=diagram.elements,b=0,c=d.length;c>b;b++)a=d[b],a.x=a.px=diagram.snap.x*Math.floor(a.x/diagram.snap.x),a.y=a.py=diagram.snap.y*Math.floor(a.y/diagram.snap.y);return svg.tick()},label:"Snap to grid",glyph:"magnet",hotkey:"ctrl+space"},"switch":{fun:function(){var a,b,c,d,e,f,g,h,i,j;for(g=diagram.selection,c=0,e=g.length;e>c;c++)if(b=g[c],b instanceof D&&(h=[b.target,b.source],b.source=h[0],b.target=h[1]),b instanceof s)for(i=diagram.links,d=0,f=i.length;f>d;d++)a=i[d],j=[a.target,a.source],a.source=j[0],a.target=j[1];return svg.tick()},label:"Switch link direction",glyph:"transfer",hotkey:"w"},cycle_start_marker:{fun:function(){var a,b,c,d,e,f,g,h;for(g=diagram.selection,c=0,e=g.length;e>c;c++)if(b=g[c],b instanceof D&&I._cycle(b,!0),b instanceof s)for(h=diagram.links,d=0,f=h.length;f>d;d++)a=h[d],I._cycle(a,!0);return svg.sync(!0)},label:"Cycle start marker",glyph:"arrow-right",hotkey:"m s"},cycle_end_marker:{fun:function(){var a,b,c,d,e,f,g,h;for(g=diagram.selection,c=0,e=g.length;e>c;c++)if(b=g[c],b instanceof D&&I._cycle(b),b instanceof s)for(h=diagram.links,d=0,f=h.length;f>d;d++)a=h[d],I._cycle(a);return svg.sync(!0)},label:"Cycle end marker",glyph:"arrow-left",hotkey:"m e"},back_to_list:{fun:function(){return diagram.force&&diagram.force.stop(),diagram instanceof o.Dot&&$("textarea.dot").val(diagram.to_dot()),location.href="#"},label:"Go back to diagram list",glyph:"list",hotkey:"esc"},cut:{fun:ub,hotkey:"ctrl+x"},copy:{fun:tb,hotkey:"ctrl+c"},paste:{fun:bc,hotkey:"ctrl+v"}},$(function(){var a,b,c;for(c in sb)b=sb[c],b.glyph&&(a=d3.select(".btns").append("button").attr("title",""+b.label+" ["+b.hotkey+"]").attr("class","btn btn-default btn-sm").on("click",b.fun).append("span").attr("class","glyphicon glyphicon-"+b.glyph)),Mousetrap.bind(b.hotkey,tc(b.fun));return Mousetrap.bind("z",function(){return Jb.fun.apply(this,Jb.args)}),$(window).on("cut",ub).on("copy",tb).on("paste",bc),$(".waterlogo").on("wheel",function(a){return history.go(a.originalEvent.deltaY>0?-1:1)})}),Ib=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,t,u,v,w,x,y;u=diagram.force_conf;for(b in u){r=u[b],v={increase:1.1,decrease:.9};for(t in v)k=v[t],Mousetrap.bind("f "+b[0]+" "+("increase"===t?"+":"-"),function(a,b){return tc(function(){return diagram.force&&(diagram.force_conf[a]*=b,diagram.force.stop()),diagram.start_force()})}(b,k))}q=[],$("aside .icons .specific").each(function(){return Mousetrap.unbind($(this).attr("data-hotkey"))}),$("aside .icons svg").remove(),$("aside h3").attr("id",diagram.cls.name).addClass("specific").text(diagram.label),w=diagram.types.elements;for(o in w)if(a=w[o],!a.alias){for(i=1,l=o[0].toLowerCase();i<o.length&&wc.call(q,l)>=0;)l=o[i++].toLowerCase();q.push(l),g=function(a){return function(){return Yb(a)}}(a),h="a "+l,j=new a(0,0,o),p=d3.select("aside .icons").append("svg").attr("class","icon specific draggable btn btn-default").attr("title",""+o+" ["+h+"]").attr("data-hotkey",h).attr("data-type",o).call(Eb),e=p.selectAll("g.element").data([j]),e.enter().call(Db,!1),e.call(sc),n=3,p.attr("viewBox",""+(-j.width()/2-n)+" "+(-j.height()/2-n)+" "+(j.width()+2*n)+" "+(j.height()+2*n)).attr("width",j.width()).attr("height",j.height()).attr("preserveAspectRatio","xMidYMid meet"),Mousetrap.bind(h,tc(g))}q=[],f=!0,x=diagram.types.links,y=[];for(o in x){for(a=x[o],i=1,l=o[0].toLowerCase();i<o.length&&wc.call(q,l)>=0;)l=o[i++].toLowerCase();q.push(l),h="l "+l,j=new a(c=new s(0,0),d=new s(100,0)),c.set_txt_bbox({width:10,height:10}),d.set_txt_bbox({width:10,height:10}),g=function(a){return function(){return diagram.last_types.link=a,d3.selectAll("aside .icons .link").classed("active",!1),d3.select(this).classed("active",!0)}},p=d3.select("aside .icons").append("svg").attr("class","icon specific btn btn-default link "+o).attr("title",""+o+" ["+h+"]").attr("data-hotkey",h).classed("active",f).on("click",g(a)),m=p.selectAll("g.link").data([j]),m.enter().call(Bb,!1),m.call(qc),m.call(ic),p.attr("height",20).attr("viewBox","0 -10 100 20"),Mousetrap.bind(h,tc(g)),f?(diagram.last_types.link=a,y.push(f=!1)):y.push(void 0)}return y},zb=function(a,b,c){var d,e,f,g,h,i,j;return null==c&&(c=!0),d=$("#overlay").addClass("visible"),e=d.find("textarea"),e.on("input",function(){var a;return b(function(){var b,c,d,e;for(d=this.value.split("\n"),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a||" ");return e}.call(this).join("\n")),svg.sync()}).on("keydown",function(a){return 27===a.keyCode?d.click():void 0}),c?(d.find(".with-color").show(),j=a(),i=j[0],h=j[1],f=j[2],$(".color-box.fg").css("background-color",h||"#000000"),$(".color-box.bg").css("background-color",f||"#ffffff")):(d.find(".with-color").hide(),i=a()),e.val(i).select().focus(),g=function(a){return a.target===this?(e.off("input"),e.off("keydown"),e.val(""),d.removeClass("visible"),$(".color-box").colpickHide(),svg.sync(!0)):void 0},d.on("click",g).on("touchstart",g)},$(function(){return $(".color-box").colpick({layout:"hex",submit:0,onChange:function(a,b,c,d){var e,f,g,h,i,j;for(e=$(d),e.css("background-color","#"+b),f=e.hasClass("fg"),j=diagram.selection,h=0,i=j.length;i>h;h++)g=j[h],g.attrs||(g.attrs={}),f?g.attrs.color="#"+b:g.attrs.fillcolor="#"+b;return svg.sync()}})}),gc=d3.behavior.drag().on("dragstart.selection",function(){d3.event.sourceEvent.shiftKey||(diagram.selection=[],diagram.linking.length&&(diagram.linking=[],svg.sync()),svg.tick())}).on("drag.selection",function(){var a,b,c;if(d3.event.sourceEvent.shiftKey)return c=svg.svg.select("rect.selection"),c.empty()&&(c=svg.svg.select("#bg").append("rect").attr({"class":"selection",x:d3.event.x,y:d3.event.y,width:0,height:0})),b={x:+c.attr("x"),y:+c.attr("y"),width:+c.attr("width"),height:+c.attr("height")},a={x:d3.event.x-b.x,y:d3.event.y-b.y},a.x<1||2*a.x<b.width?(b.x=d3.event.x,b.width-=a.x):b.width=a.x,a.y<1||2*a.y<b.height?(b.y=d3.event.y,b.height-=a.y):b.height=a.y,b.width=Math.max(0,b.width),b.height=Math.max(0,b.height),c.attr(b),svg.svg.selectAll("g.element").each(function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(c=d3.select(this),f=wc.call(diagram.selection,a)>=0,d=a["in"](b),d&&!f){for(diagram.selection.push(a),k=diagram.links,q=[],g=0,i=k.length;i>g;g++)e=k[g],q.push(e.source===a&&(l=e.target,wc.call(diagram.selection,l)>=0)&&wc.call(diagram.selection,e)<0||e.target===a&&(m=e.source,wc.call(diagram.selection,m)>=0)&&wc.call(diagram.selection,e)<0?diagram.selection.push(e):void 0);return q}if(!d&&f){for(diagram.selection.splice(diagram.selection.indexOf(a),1),n=diagram.links,r=[],h=0,j=n.length;j>h;h++)e=n[h],r.push(e.source===a&&(o=e.target,wc.call(diagram.selection,o)<0)&&wc.call(diagram.selection,e)>=0||e.target===a&&(p=e.source,wc.call(diagram.selection,p)<0)&&wc.call(diagram.selection,e)>=0?diagram.selection.splice(diagram.selection.indexOf(e),1):void 0);return r}}),svg.tick()}).on("dragend.selection",function(){var a,b,c,d,e;return b=svg.svg.select("rect.selection"),b.empty()||(d=+b.attr("x"),e=+b.attr("y"),c=+b.attr("width"),a=+b.attr("height"),svg.sync()),svg.svg.selectAll("rect.selection").remove()}),Wb=d3.behavior.drag().origin(function(a){return a}).on("dragstart.move",function(a){return svg.svg.classed("dragging",!0),svg.svg.classed("translating",!0),wc.call(diagram.selection,a)<0&&(d3.event.sourceEvent.shiftKey?diagram.selection.push(a):diagram.selection=[a]),a.ts=kc(),a instanceof v&&(a.ts*=-1),svg.svg.selectAll("g.element").sort(ac),svg.tick(),d3.event.sourceEvent.stopPropagation()}).on("drag.move",function(a){var b,c,d,e,f,g,h,i,j,k,l;for(d=diagram.force?"px":"x",e=diagram.force?"py":"y",j=!a,wc.call(diagram.selection,j)>=0&&diagram.selection.push(a),k=diagram.selection,f=0,h=k.length;h>f;f++)c=k[f],c.fixed=!0;for(b=d3.event.sourceEvent.shiftKey?{x:a[d]-d3.event.x,y:a[e]-d3.event.y}:{x:a[d]-diagram.snap.x*Math.floor(d3.event.x/diagram.snap.x),y:a[e]-diagram.snap.y*Math.floor(d3.event.y/diagram.snap.y)},l=diagram.selection,g=0,i=l.length;i>g;g++)c=l[g],c[d]-=b.x,c[e]-=b.y;return diagram.force?diagram.force.resume():svg.tick()}).on("dragend.move",function(a){var b,c,d,e,f,g,h,i,j,k,l;for(svg.svg.classed("dragging",!1),svg.svg.classed("translating",!1),j=diagram.elements,d=0,g=j.length;g>d;d++)a=j[d],a.fixed=!1;if(diagram.dragging=!1,!$(d3.event.sourceEvent.target).closest(".inside").size()){for(k=diagram.selection,e=0,h=k.length;h>e;e++)for(a=k[e],wc.call(diagram.elements,a)>=0&&diagram.elements.splice(diagram.elements.indexOf(a),1),l=diagram.links.slice(),f=0,i=l.length;i>f;f++)c=l[f],(a===c.source||a===c.target)&&(b=diagram.links.indexOf(c),b>=0&&diagram.links.splice(b,1));diagram.selection=[]}return svg.sync(!0)}),$b=d3.behavior.drag().on("dragstart.resize",function(){var a;return svg.svg.classed("dragging",!0),svg.svg.classed("resizing",!0),a=d3.select($(this).closest(".element").get(0)).data()[0],diagram._origin=Vb(svg.svg.node()),a.ox=a.x,a.oy=a.y,a.owidth=a.width(),a.oheight=a.height(),a.fixed=!0,d3.event.sourceEvent.stopPropagation()}).on("drag.resize",function(a){var b,c,d,e,f,g,h,i,j;return f=d3.select($(this).closest(".element").get(0)),e=f.data()[0],d=Vb(svg.svg.node()),"O"===a?(c={x:d.x-e.x,y:d.y-e.y},b=mb(c.y,c.x)+cc/2,d3.event.sourceEvent.shiftKey||(b=mc(diagram.snap.a*Math.floor(lc(b)/diagram.snap.a))),e._rotation=b):(c={x:d.x-diagram._origin.x,y:d.y-diagram._origin.y},c=ec(c,2*cc-e._rotation),i=diagram.force?"px":"x",j=diagram.force?"py":"y",h=qb(a),e.width(e.owidth+h.x*c.x),e.height(e.oheight+h.y*c.y),g={x:h.x*(e.width()-e.owidth)/2,y:h.y*(e.height()-e.oheight)/2},g=ec(g,e._rotation),e[i]=e.ox+g.x,e[j]=e.oy+g.y,f.call(sc)),svg.tick()}).on("dragend.resize",function(){var a;return svg.svg.classed("dragging",!1),svg.svg.classed("resizing",!1),a=d3.select($(this).closest(".element").get(0)).data()[0],a.ox=a.oy=a.owidth=a.oheight=null,a.fixed=!1,svg.sync(!0)}),kb=d3.behavior.drag().on("dragstart.link",function(){return svg.svg.classed("dragging",!0),svg.svg.classed("linking",!0),d3.event.sourceEvent.stopPropagation()}).on("drag.link",function(a){var b,c,d,e,f,g,h;return diagram.linking.length||(f=d3.select($(this).closest(".element").get(0)).data()[0],h=diagram.last_types.link,e=new h(f,new J(0,0,"")),e.source_anchor=a,diagram.linking.push(e),svg.sync()),e=diagram.linking[0],d=d3.event.sourceEvent,g="touchmove"===d.type?document.elementFromPoint(d.targetTouches[0].clientX,d.targetTouches[0].clientY):d.target,b=$(g).closest(".anchor"),c=b.size()?b.closest(".element"):$(g).closest(".element"),c.size()?(e.target=c.get(0).__data__,e.target_anchor=b.size()?+b.attr("data-anchor"):null):(e.target instanceof J||(e.target=new J(0,0,"")),e.target.x=e.source.x+d3.event.x,e.target.y=e.source.y+d3.event.y),svg.tick()}).on("dragend.link",function(){var a;return svg.svg.classed("dragging",!1),svg.svg.classed("linking",!1),diagram.linking.length?(a=diagram.linking[0],diagram.linking=[],a.target instanceof J?svg.sync():(diagram.links.push(a),svg.sync(!0))):void 0}),Ub=function(a){return a.call(Ab,function(a){return zb(function(){var b,c;return[a.text,null!=(b=a.attrs)?b.color:void 0,null!=(c=a.attrs)?c.fillcolor:void 0]},function(b){return a.text=b})})},Tb=function(a){return a.call(Ab,function(a){var b;return b=a.nearest(Vb(svg.svg.node())),b===a.source?zb(function(){return[a.text.source,null,null]},function(b){return a.text.source=b}):zb(function(){return[a.text.target,null,null]},function(b){return a.text.target=b})})},Kb=d3.behavior.drag().on("dragstart.link",function(a){return d3.event.sourceEvent.shiftKey||(diagram.selection=[]),diagram.selection.push(a),svg.tick(),svg.svg.classed("dragging",!0),svg.svg.classed("linking",!0),d3.event.sourceEvent.stopPropagation()}).on("drag.link",function(a){var b,c,d,e,f,g;return diagram.linking.length||(diagram.links.splice(diagram.links.indexOf(a),1),e=new J(d3.event.x,d3.event.y,""),f=a.nearest(e),a.source===f&&(a.source=a.target,a.source_anchor=a.target_anchor),a.target=e,a.target_anchor=null,diagram.linking.push(a),svg.sync()),d=d3.event.sourceEvent,g="touchmove"===d.type?document.elementFromPoint(d.targetTouches[0].clientX,d.targetTouches[0].clientY):d.target,a=diagram.linking[0],b=$(g).closest(".anchor"),c=b.size()?b.closest(".element"):$(g).closest(".element"),c.size()?(a.target=c.get(0).__data__,a.target_anchor=b.size()?+b.attr("data-anchor"):null):(a.target instanceof J||(a.target=new J(0,0,"")),a.target.x=d3.event.x,a.target.y=d3.event.y),svg.tick()
}).on("dragend.link",function(){var a;return svg.svg.classed("dragging",!1),svg.svg.classed("linking",!1),diagram.linking.length?(a=diagram.linking[0],diagram.linking=[],a.target instanceof J?svg.sync():(diagram.links.push(a),svg.sync(!0))):void 0}),Fb=null,Eb=d3.behavior.drag().on("dragstart.extern",function(){var a;if(!Fb)return a=$(this),Fb={$elt:$(this.cloneNode(!0)),offset:{top:a.parent().offset().top-a.outerHeight()/2,left:a.parent().offset().left-a.outerWidth()/2}},$("body").append(Fb.$elt.css({position:"fixed"})),d3.event.sourceEvent.stopPropagation()}).on("drag.extern",function(){return Fb.$elt.css({top:Fb.offset.top+d3.event.y,left:Fb.offset.left+d3.event.x})}).on("dragend.extern",function(){var a,b,c;if(Fb)return b=Fb.$elt.offset().left-$("#diagram").offset().left+Fb.$elt.outerWidth()/2,c=Fb.$elt.offset().top-$("#diagram").offset().top+Fb.$elt.outerHeight()/2,b=(b-diagram.zoom.translate[0])/diagram.zoom.scale,c=(c-diagram.zoom.translate[1])/diagram.zoom.scale,b=diagram.snap.x*Math.floor(b/diagram.snap.x),c=diagram.snap.y*Math.floor(c/diagram.snap.y),a=Fb.$elt.attr("data-type"),Yb(a,b,c),Fb.$elt.remove(),Fb=null}),Ab=function(a,b){return a.on("dblclick",b).dblTap(b)},Db=function(a,b){var c;return null==b&&(b=!0),c=a.append("g").attr("class","element"),c.append("path").attr("class","ghost"),c.append("path").attr("class",function(a){return"shape fill-"+a.cls.fill+" stroke-"+a.cls.stroke}),c.append("text"),b?(c.append("g").attr("class","handles").each(function(a){return d3.select(this).selectAll(".handle").data(a.handle_list()).enter().append("path").attr("class",function(a){return"handle "+a.toLowerCase()}).call($b)}),c.append("g").attr("class","anchors").each(function(a){return d3.select(this).selectAll(".anchor").data(a.anchor_list()).enter().append("path").attr("class",function(a){return"anchor "+a}).attr("data-anchor",function(a){return a}).call(kb)}),c.call(Wb),c.call(Ub)):void 0},uc=function(a,b){var c,d,e,f,g,h,i;for(a.selectAll("tspan").remove(),h=b.split("\n"),i=[],c=f=0,g=h.length;g>f;c=++f)d=h[c],e=a.append("tspan").text(d).attr("x",0),i.push(0!==c?e.attr("dy","1.2em"):void 0);return i},sc=function(a){return a.select("text").each(function(a){var b,c;return c=d3.select(this),b=c.selectAll("tspan")[0].map(function(a){return d3.select(a).text()}).join("\n"),a.text!==b?c.call(uc,a.text):void 0}).each(function(a){return a.set_txt_bbox(this.getBBox())}).attr("x",function(a){return a.txt_x()}).attr("y",function(a){return a.txt_y()}).selectAll("tspan").attr("x",function(a){return a.txt_x()}),a.select(".shape").attr("class",function(a){return"shape fill-"+a.cls.fill+" stroke-"+a.cls.stroke}).attr("style",Zb).attr("d",function(a){return a.path()}),a.select(".ghost").attr("d",function(a){return a instanceof v?"M 0 0":ab.prototype.path.apply(a)}),a.call(pc),a.call(oc)},Bb=function(a,b){var c;return null==b&&(b=!0),c=a.append("g").attr("class","link"),c.append("path").attr("class","ghost"),c.append("path").attr("class",function(a){return"shape "+a.cls.type}).attr("marker-start",function(a){var b;return"url(#"+((null!=(b=a.marker_start)?b.id:void 0)||a.cls.marker_start.id)+")"}).attr("marker-end",function(a){var b;return"url(#"+((null!=(b=a.marker_end)?b.id:void 0)||a.cls.marker_end.id)+")"}),c.each(function(a){var b,c;return b=d3.select(this),a.text.source&&(c=b.append("text").attr("class","start").call(uc,a.text.source),a._source_bbox=c.node().getBBox()),a.text.target?(c=b.append("text").attr("class","end").call(uc,a.text.target),a._target_bbox=c.node().getBBox()):void 0}),b?(c.call(Tb),c.call(Kb)):void 0},qc=function(a){return a.each(function(a){var b,c;return d3.select(this).selectAll("path").attr("d",a.path()).attr("marker-start","url(#"+((null!=(c=a.marker_start)?c.id:void 0)||a.cls.marker_start.id)+")").attr("marker-end","url(#"+((null!=(b=a.marker_end)?b.id:void 0)||a.cls.marker_end.id)+")")}),a.each(function(a){var b,c;return b=d3.select(this),c=b.select("text.start").node(),a.text.source&&!c&&b.append("text").attr("class","start"),c=b.select("text.end").node(),a.text.target&&!c&&b.append("text").attr("class","end"),b.select(".shape").attr("style",Zb)}),a.select("text.start").each(function(a){var b,c;return c=d3.select(this),b=c.text(),a.text.source!==b||null==a._source_bbox?""===a.text.source.trim()?void c.remove():(c.call(uc,a.text.source),a._source_bbox=c.node().getBBox()):void 0}),a.select("text.end").each(function(a){var b,c;return c=d3.select(this),b=c.text(),!a.text.target!==b||null==a._target_bbox?""===a.text.target.trim()?void c.remove():(c.call(uc,a.text.target),a._target_bbox=c.node().getBBox()):void 0})},pc=function(a){return a.each(function(a){var b;return b=a.cls.handle_size,d3.select(this).selectAll(".handle").data(a.handle_list()).attr("d",function(c){var d,e;return d=a.handles[c](),"O"!==c?(e=qb(c),"M "+d.x+" "+d.y+" L "+(d.x+e.x*b)+" "+d.y+" L "+(d.x+e.x*b)+" "+(d.y+e.y*b)+" L "+d.x+" "+(d.y+e.y*b)+" z"):"M "+d.x+" "+d.y+" L "+d.x+" "+(d.y-2*b)+" A "+b+" "+b+" 0 1 1 "+d.x+" "+(d.y-4*b)+" A "+b+" "+b+" 0 1 1 "+d.x+" "+(d.y-2*b)})})},oc=function(a){return a.each(function(a){var b;return b=a.cls.handle_size,d3.select(this).selectAll(".anchor").data(a.anchor_list()).attr("transform",function(b){var c;return c=a.anchors[b](),"rotate("+nc(b)+", "+(c.x-a.x)+", "+(c.y-a.y)+")"}).attr("d",function(c){var d;return d=a.anchors[c](),void 0===d.x||void 0===d.y||void 0===a.x||void 0===a.y?"M 0 0":(d.x-=a.x,d.y-=a.y,"M "+d.x+" "+d.y+" L "+d.x+" "+(d.y+b)+" L "+(d.x+b)+" "+d.y+" L "+d.x+" "+(d.y-b)+" z")})})},jc=function(a){return a.attr("transform",function(a){return"translate("+a.x+","+a.y+")rotate("+nc(a._rotation)+")"}).classed("selected",function(a){return wc.call(diagram.selection,a)>=0})},ic=function(a){return a.classed("selected",function(a){return wc.call(diagram.selection,a)>=0}),a.each(function(a){return d3.select(this).selectAll("path").attr("d",a.path())}),a.select("text.start").attr("transform",function(a){var b,c,d;return b=a._source_bbox,d={x:a.text_margin+b.width/2,y:a.text_margin+b.height/2},c=ec(d,a.o1+3*cc/2),"translate("+(a.a1.x+c.x)+", "+(a.a1.y+c.y)+")"}),a.select("text.end").attr("transform",function(a){var b,c,d;return b=a._target_bbox,d={x:a.text_margin+b.width/2,y:a.text_margin+b.height/2},c=ec(d,a.o2+3*cc/2),"translate("+(a.a2.x+c.x)+", "+(a.a2.y+c.y)+")"})},Cb=function(a,b){return null==b&&(b=!1),a.append("marker").append("path")},rc=function(a){return a.attr("id",function(a){return a.id}).attr("class",function(a){return"marker fill-"+(a.open?"bg":"fg")+" stroke-fg"}).attr("viewBox",function(a){return a.viewbox()}).attr("markerUnits","userSpaceOnUse").attr("markerWidth",function(a){return a.width()}).attr("markerHeight",function(a){return a.height()}).attr("orient","auto").each(function(a){return d3.select(this).select("path").attr("d",a.path())})},Vb=function(a){var b;return b=d3.mouse(a),{x:(b[0]-diagram.zoom.translate[0])/diagram.zoom.scale,y:(b[1]-diagram.zoom.translate[1])/diagram.zoom.scale}},vc=d3.behavior.zoom(),fb=function(a){function b(){this.create=zc(this.create,this);var a;b.__super__.constructor.apply(this,arguments),a=d3.select("article").node(),this.width=a.clientWidth,this.height=a.clientHeight||500,this.zoom=vc.scale(diagram.zoom.scale).translate(diagram.zoom.translate).scaleExtent([.05,5]).on("zoom",function(){return d3.event.sourceEvent.shiftKey?void 0:(diagram.zoom.translate=d3.event.translate,diagram.zoom.scale=d3.event.scale,svg.sync_transform())}).on("zoomend",function(){return svg.sync(!0)}),d3.select(".inside").selectAll("svg").data([diagram]).enter().append("svg").attr("id","diagram").attr("width",this.width).attr("height",this.height).call(this.create),this.svg=d3.select("#diagram").call(gc)}return yc(b,a),b.prototype.sync_transform=function(){return d3.select(".root").attr("transform","translate("+diagram.zoom.translate+")scale("+diagram.zoom.scale+")"),d3.select("#grid").attr("patternTransform","translate("+diagram.zoom.translate+")scale("+diagram.zoom.scale+")")},b.prototype.create=function(a){var b,c,d,e,f;return d=a.append("defs"),c=a.append("g").attr("id","bg"),b=c.append("rect").attr("class","background").attr("width",this.width).attr("height",this.height).attr("fill","url(#grid)").call(this.zoom),a.append("text").attr("id","title").attr("x",this.width/2).attr("y",50).call(Ab,function(){return zb(function(){return diagram.title},function(a){return diagram.title=a},!1)}),d3.select(window).on("resize",function(a){return function(){return a.resize()}}(this)),e=d.append("pattern").attr("id","grid").attr("viewBox","0 0 10 10").attr("x",0).attr("y",0).attr("width",diagram.snap.x).attr("height",diagram.snap.y).attr("patternUnits","userSpaceOnUse"),e.append("path").attr("d","M 10 0 L 0 0 L 0 10"),f=c.append("g").attr("class","root"),f.append("g").attr("class","underlay"),f.append("g").attr("class","links"),f.append("g").attr("class","elements"),f.append("g").attr("class","overlay")},b.prototype.sync=function(a){var b,c,d;return null==a&&(a=!1),this.zoom.scale(diagram.zoom.scale),this.zoom.translate(diagram.zoom.translate),this.sync_transform(),this.svg.select("#title").text(diagram.title),d=this.svg.select("defs").selectAll("marker").data(diagram.markers()),d.enter().call(Cb),d.call(rc),d.exit().remove(),b=this.svg.select("g.elements").selectAll("g.element").data(diagram.elements.sort(ac)),c=this.svg.select("g.links").selectAll("g.link").data(diagram.links.concat(diagram.linking)),b.enter().call(Db),c.enter().call(Bb),b.call(sc),c.call(qc),b.exit().remove(),c.exit().remove(),this.tick(),a&&!diagram.force&&Gb(),diagram.force?(diagram.force.stop(),diagram.force.nodes(diagram.elements).links(diagram.links),diagram.force.start()):void 0},b.prototype.tick=function(){return this.svg.select("g.elements").selectAll("g.element").call(jc),this.svg.select("g.links").selectAll("g.link").call(ic)},b.prototype.resize=function(){var a;return a=d3.select(".inside").node(),this.width=a.clientWidth,this.height=a.clientHeight||500,this.svg.attr("width",this.width).attr("height",this.height),d3.select(".background").attr("width",this.width).attr("height",this.height),this.svg.select("#title").attr("x",this.width/2)},b}(g),Ob=function(a){var b;return b=o._get(a.name),window.diagram=new b,window.svg=new fb,diagram.loads(a)},fc=function(){return localStorage.setItem(""+diagram.cls.name+"|"+diagram.title,diagram.hash())},Gb=function(){var a;if(location.hash)return a="#"+diagram.hash(),location.hash!==a?history.pushState(null,null,a):void 0},Hb=function(){var a,b,c,d,e,f,g,h,i,j,k,l;if(a=$("#diagrams"),b=$("#editor"),!location.hash)return void(b.hasClass("hidden")||(a.removeClass("hidden"),b.addClass("hidden"),$("aside h3").attr("id",""),Lb()));if(b.removeClass("hidden"),a.addClass("hidden"),"?nocatch/"===location.search)Ob(JSON.parse(LZString.decompressFromBase64(location.hash.slice(1))));else try{Ob(JSON.parse(LZString.decompressFromBase64(location.hash.slice(1))))}catch(m){i=m;try{Ob(JSON.parse(decodeURIComponent(escape(atob(location.hash.slice(1))))))}catch(m){j=m,window.diagram=new o.Dot,l=o.Dot.prototype.types.elements.Note,k=o.Dot.prototype.types.links.Link,window.svg=new fb,diagram.title="There was an error loading your diagram :(",diagram.elements.push(c=new l(void 0,void 0,i.message)),diagram.elements.push(d=new l(void 0,void 0,i.stack)),diagram.elements.push(e=new l(void 0,void 0,j.message)),diagram.elements.push(f=new l(void 0,void 0,j.stack)),diagram.elements.push(g=new l(void 0,void 0,"You can try to reload\nyour browser without cache")),diagram.elements.push(h=new l(void 0,void 0,"Otherwise it may be that\n your diagram is not compatible\nwith this version")),diagram.links.push(new k(d,c)),diagram.links.push(new k(d,g)),diagram.links.push(new k(d,h)),diagram.links.push(new k(e,c)),diagram.links.push(new k(f,d)),diagram.links.push(new k(e,f)),diagram.start_force()}}return Ib(),svg.resize(),"webkitRequestAnimationFrame"in window&&setTimeout(function(){return svg.sync()},50),svg.sync()},Mb=function(){var a,b,c,d,e,f,g;a=$(".table.local tbody"),a.find("tr").remove(),$(".local").show();for(d in localStorage)c=localStorage[d],g=d.split("|"),f=g[0],e=g[1],null!=e&&(a.append(b=$("<tr>")),b.append($("<td>").text(e),$("<td>").text((new(o._get(f))).label),$("<td>").append($("<a>").attr("href","#"+c).append($("<i>",{"class":"glyphicon glyphicon-folder-open"}))).append($("<a>").attr("href","#").append($("<i>",{"class":"glyphicon glyphicon-trash"})).on("click",function(a){return function(){return localStorage.removeItem(a),$(this).closest("tr").remove(),!1}}(d)))));return a.find("tr").size()?void 0:$(".local").hide()},Nb=function(){var a,b,c,d,e,f,g;a=$(".table.new tbody"),a.find("tr").remove(),g=[];for(e in o)f=o[e],e.match(/^_/)||(d=new f,c=d.hash(),a.append(b=$("<tr>")),g.push(b.append($("<td>").text(d.label),$("<td>").append($("<a>").attr("href","#"+c).append($("<i>",{"class":"glyphicon glyphicon-file"}))))));return g},Lb=function(){return Mb(),Nb()},A=["node","edge","graph","digraph","subgraph","strict"],f=["[","{","}","]"],l=[":",";",","],N=["--","->"],i=["n","ne","e","se","s","sw","w","nw","c","_"],_=/\s/,W=/[a-zA-Z_\u00C0-\u017F]/,Z=/\d|\./,X=/[a-zA-Z0-9_\u00C0-\u017F]/,Y=/\/|\#/,Q=9999,S=function(){function a(a){this.message=a}return a}(),gb=function(){function a(a){this.value=a}return a}(),B=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(gb),y=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(gb),M=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(y),V=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(y),h=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(gb),m=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(gb),b=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(gb),P=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return yc(b,a),b}(gb),yb=function(a){var c,d,e,g,i,j,k,n,o,p,q,r,s;for(n=0,o=0,d=0,j=a.length,q=[],i=c=null;j>n;)if(i=c,p=null,d++,c=a[n++],c.match(_))"\n"===c&&(o++,d=0);else{if("="===c)p=new b(c);else if("-"===c)k=c+a[n++],wc.call(N,k)>=0&&(p=new P(k));else if(wc.call(f,c)>=0)p=new h(c);else if(wc.call(l,c)>=0)p=new m(c);else if(c.match(W)){for(g=c;null!=(r=c=a[n++])?r.match(X):void 0;)g+=c;n--,p=wc.call(A,g)>=0?new B(g):new y(g)}else if('"'===c){for(g="",e=!1;('"'!==(c=a[n++])||e)&&null!=c;)"\\"!==c||e?(e&&("n"===c?c="\n":"t"===c?c="	":"r"===c?c="\r":'"'===c?c='"':"\\"===c?c="\\":"\n"===c&&(c="")),g+=c,e=!1):e=!0;p=new V(g)}else if(c.match(Z)){for(g=c;null!=(s=c=a[n++])?s.match(Z):void 0;)g+=c;n--,p=new M(parseFloat(g))}else{if(!c.match(Y))throw new S("Syntax error in dot "+c+" at "+o+", "+d);if("/"===c&&"*"===a[n]){for(n+=2;("*"!==(c=a[n])||"/"!==a[n+1])&&null!=c;)"\n"===c?(o++,d=0):d++,n++;n+=2}else if("#"===c||"/"===c&&"/"===a[n])for(;"\n"!==(c=a[n])&&null!=c;)d++,n++}p&&q.push(p)}return q},u=function(){function a(a,b,c){this.type=a,this.id=b,this.strict=c,this.statements=[]}return a}(),db=function(){function a(){}return a.prototype.get_attrs=function(){var a,b,c,d,e;for(b={},e=this.attributes,c=0,d=e.length;d>c;c++)a=e[c],b[a.left]=a.right;return b},a}(),eb=function(){function a(a){this.id=a,this.statements=[]}return a}(),K=function(a){function b(a,b,c){this.id=a,this.port=b,this.compass_pt=c}return yc(b,a),b}(db),q=function(a){function b(){this.nodes=[],this.attributes=[]}return yc(b,a),b}(db),d=function(){function a(a,b){this.left=a,this.right=b}return a}(),e=function(a){function b(a){this.type=a,this.attributes=[]}return yc(b,a),b}(db),xb=function(a){var c,f,g,j,k,l,n,o,p,r,s,t,v;if(s=0,g=0,!(a[s]instanceof B))throw new S("First token is not a keyword");if(t=!1,"strict"===a[s].value&&(t=!0,s++),v=null,"graph"===a[s].value?v="normal":"digraph"===a[s].value&&(v="directed"),null===v)throw new S("Unknown graph type");if(f=null,a[++s]instanceof y&&(f=a[s++].value),j=function(){var c,e;if(a[s]instanceof h&&"]"===a[s].value){if(!(a[s+1]instanceof h&&"["===a[s+1].value))return null;s+=2}if(!(a[s]instanceof y))throw new S("Invalid left hand side of attribute '"+a[s].value+"'");if(c=a[s].value,s++,!(a[s]instanceof b))throw new S("Invalid assignement '"+a[s].value+"'");if(s++,!(a[s]instanceof y))throw new S("Invalid right hand side of attribute '"+a[s].value+"'");return e=a[s].value,new d(c,e)},k=function(){var b,c,d;if(!(a[s]instanceof h&&"["===a[s].value))throw new S('No opening brace "[" for attribute list');for(s++,c=[],d=0;d++<Q&&(b=j(),null!==b);)s++,c.push(b),a[s]instanceof m&&","===a[s].value&&s++;if(--d===Q)throw new S("Infinite loop for statement list parsing");return c},r=function(){var b;return f=null,a[s]instanceof B&&"subgraph"===a[s].value&&(s++,a[s]instanceof y&&(f=a[s++].value)),b=new eb(f),b.statements=p(),b},l=function(){var b,c,d,e;if(a[s]instanceof B&&"subgraph"===a[s].value)c=r();else if(a[s]instanceof h&&"{"===a[s].value)c=r();else{if(!(a[s]instanceof y))throw new S("Invalid edge id '"+a[s].value+"'");if(f=a[s].value,d=null,b=null,a[s+1]instanceof m&&":"===a[s+1].value){if(s+=2,!(a[s]instanceof y))throw new S("Invalid port id '"+a[s].value+"'");if(d=a[s].value,a[s+1]instanceof m&&":"===a[s+1].value){if(s+=2,!(a[s]instanceof y)||(e=a[s].value,wc.call(i,e)<0))throw new S("Invalid compass point '"+a[s].value+"'");b=a[s].value}d&&!b&&wc.call(i,d)>=0&&(b=d,d=null)}c=new K(f,d,b)}return c},n=function(){var b;for(b=[l()];a[s+1]instanceof P;)s+=2,b.push(l());return b},o=function(){var c,f,g;if(a[s]instanceof h&&"}"===a[s].value)return null;if(a[s]instanceof B&&"subgraph"!==a[s].value){if("graph"!==(g=a[s].value)&&"node"!==g&&"edge"!==g)throw new S("Unexpected keyword "+a[s]);return f=new e(a[s++].value),f.attributes=k(),f}if(!(a[s]instanceof y||a[s]instanceof B&&"subgraph"===a[s].value||a[s]instanceof h&&"{"===a[s].value))throw new S("Unexpected statement '"+a[s].value+"'");if(a[s]instanceof y&&a[s+1]instanceof b){if(c=a[s].value,s+=2,!(a[s]instanceof y))throw new S("Invalid right hand side of attribute '"+a[s].value+"'");return f=new d(c,a[s].value)}return f=new q,f.nodes=n(),a[s+1]instanceof h&&"["===a[s+1].value&&(s++,f.attributes=k()),f},p=function(){var b,c,d;if(!(a[s]instanceof h&&"{"===a[s].value))throw S('No opening brace "{" for statement list');for(s++,d=[],b=0;b++<Q&&(c=o(),null!==c);)s++,d.push(c),a[s]instanceof m&&";"===a[s].value&&s++;if(--b===Q)throw S("Infinite loop for statement list parsing");return d},c=new u(v,f,t),c.statements=p(),s+1!==a.length)throw S("Error in dot file, parsed "+s+" elements out of "+a.length);return window.g=c},wb=function(a){var b,c,f,g,h,i,j,k,l,m,n,p,r,s,t,u,v,w,x,y;t=yb(a),k=xb(t),f=window.diagram=new o.Dot,window.svg=new fb,r={},n=[],b={graph:{},edge:{},node:{}},c=function(){return{graph:_b(b.graph),edge:_b(b.edge),node:_b(b.node)}},s=function(a){var g,h,i,j,k,l,m,o,p,t,u,v,w,x,y,z,A;for(A=[],y=0,z=a.length;z>y;y++)p=a[y],p instanceof e?Qb(b[p.type],p.get_attrs()):p instanceof d?b.graph[p.left]=p.right:p instanceof q?(h=c(),1===p.nodes.length?Qb(h.node,p.get_attrs()):Qb(h.edge,p.get_attrs()),A.push(function(){var d,e,q,y;for(q=p.nodes,y=[],i=d=0,e=q.length;e>d;i=++d)l=q[i],l instanceof eb?(m=c(),s(l.statements),b=m):l.id in r&&1!==a.length||(j=h.node.label||l.id,x=h.node.shape||"ellipse",g=f.types.elements[ob(x)]||f.types.elements.Ellipse,r[l.id]={label:j,type:g,attrs:h.node}),0!==i?(o=p.nodes[i-1],k=f.types.links.Link,y.push(o instanceof eb?function(){var a,b,c,d;for(c=o.statements,d=[],a=0,b=c.length;b>a;a++)v=c[a],d.push(function(){var a,b,c,d;for(c=v.nodes,d=[],a=0,b=c.length;b>a;a++)u=c[a],d.push(l instanceof eb?function(){var a,b,c,d;for(c=l.statements,d=[],b=0,a=c.length;a>b;b++)w=c[b],d.push(function(){var a,b,c,d;for(c=w.nodes,d=[],b=0,a=c.length;a>b;b++)t=c[b],d.push(n.push({type:k,id1:u.id,id2:t.id,label:h.edge.label,attrs:h.edge}));return d}());return d}():n.push({type:k,id1:u.id,id2:l.id,label:h.edge.label,attrs:h.edge}));return d}());return d}():l instanceof eb?function(){var a,b,c,d;for(c=l.statements,d=[],a=0,b=c.length;b>a;a++)w=c[a],d.push(function(){var a,b,c,d;for(c=w.nodes,d=[],a=0,b=c.length;b>a;a++)t=c[a],d.push(n.push({type:k,id1:o.id,id2:t.id,label:h.edge.label,attrs:h.edge}));return d}());return d}():n.push({type:k,id1:o.id,id2:l.id,label:h.edge.label,attrs:h.edge}))):y.push(void 0);return y}())):console.log("Unexpected "+p);return A},s(k.statements),h={},j=!0;for(l in r)i=r[l],h[l]=g=new i.type(void 0,void 0,i.label),i.attrs.pos?(i.attrs.pos.indexOf("!")===i.attrs.pos.length-1&&(g.fixed=!0,i.attrs.pos=i.attrs.pos.slice(0,-1)),y=i.attrs.pos.split(","),u=y[0],v=y[1],g.x=+u,g.y=+v,delete i.attrs.pos):j=!1,g.attrs=i.attrs,diagram.elements.push(g);for(w=0,x=n.length;x>w;w++)p=n[w],m=new p.type(h[p.id1],h[p.id2]),m.text.source=p.label,"directed"!==k.type||p.attrs.arrowhead||(p.attrs.arrowhead="normal"),p.attrs.arrowhead&&(m.marker_end=I._get(p.attrs.arrowhead),delete p.attrs.arrowhead),p.attrs.arrowtail&&(m.marker_start=I._get(p.attrs.arrowtail,!0),delete p.attrs.arrowtail),p.attrs.headlabel&&(m.text.target=p.attrs.headlabel,delete p.attrs.headlabel),p.attrs.taillabel&&(m.text.source=p.attrs.taillabel,delete p.attrs.taillabel),m.attrs=p.attrs,diagram.links.push(m);return f.title=b.graph.label||k.id,f.force=!j,f.hash()},$(function(a){return function(){return location.pathname.match(/\/test\//)?void 0:(Lb(),$(".dot2umlaut").click(function(){return location.hash=wb($(this).siblings("textarea.dot").val())}),a.addEventListener("popstate",Hb),location.hash?Hb():void 0)}}(this))}).call(this);
//# sourceMappingURL=main.min.map